<!doctype html>
<html lang="en" ng-app="BrainDumpApp">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BrainDump</title>
	<script type="text/javascript" src="/libs/angularjs/1.2.9/angular.min.js"></script>
	<script type="text/javascript" src="/libs/angularjs/1.2.9/angular-resource.js"></script>
	<script type="text/javascript" src='/libs/angularjs/1.2.4/angular-sanitize.min.js'></script>
	<script type="text/javascript" src="/libs/angular-ui/0.11.0/ui-bootstrap.min.js"></script>
	<script type="text/javascript" src='/libs/textAngular/1.1.2/textAngular.min.js'></script>
	<script src="modules/notebooks.js"></script>
	<script src="modules/notes.js"></script>
	<script src="app.js"></script>
	<link rel='stylesheet prefetch' href='/libs/bootstrap/3.1.1/css/bootstrap.min.css'>
	<link rel='stylesheet prefetch' href='/libs/bootstrap/3.1.1/css/bootstrap-theme.min.css'>
	<link rel='stylesheet prefetch' href='/libs/font-awesome/4.1.0/css/font-awesome.min.css'>
	<link rel='stylesheet prefetch' href='/layout.css'>
	<link rel='stylesheet prefetch' href='/style.css'>
</head>
<body ng-controller="AppController">

	<!-- Header -->
	<div class="navbar navbar-inverse navbar-static-top" role="navigation">
		<div class="navbar-header">
			<span class="navbar-brand">
				<span id="brain">Brain</span><span id="dump">Dump</span>
			</span>
		</div>

		<form class="navbar-form navbar-left form-inline" role="search" style="width: 250px;">
			<div class="form-group">
				<div class="input-group">
					<input placeholder="Search" type="text" class="form-control" ng-model="query">
					<span class="input-group-btn">
						<button type="submit"class="btn btn-default" type="button" ng-click="search()">
							<span class="glyphicon glyphicon-search"></span>
						</button>
					</span>
				</div>
			</div>
		</form>
	
		<button type="button" class="btn btn-default navbar-btn navbar-right" ng-disabled="createButtonDisabled()" ng-click="createNote()">
			<span class="glyphicon glyphicon-plus"></span> Create note
		</button>			
	</div>

	<div id="app">

		<!-- Notebooks section -->
		<div class="panel panel-default" id="notebooks" ng-controller="NotebookListController" ng-init="init()">

			<!-- Modal dialog to create Notebook -->
			<script type="text/ng-template" id="newNotebookModal.html">
				<div class="modal-header">
					<h3 class="modal-title">Create notebook</h3>
				</div>
				<div class="modal-body">
					<form name="createNotebookForm" id="createNotebookForm" novalidate>
						<input type="text" class="form-control" placeholder="Title of new notebook" ng-model="notebook.title" required />
					</form>
				</div>
				<div class="modal-footer">
					<button class="btn btn-primary" ng-click="create()" ng-disabled="createNotebookForm.$invalid || !createNotebookForm.$dirty">Create</button>
					<button class="btn btn-default" ng-click="cancel()">Cancel</button>
				</div>
			</script>

			<div class="panel-heading">
				<h3 class="panel-title">Notebooks
					<div class="pull-right">
						<button type="button" class="btn btn-default btn-xs" ng-click="showNewNotebookModal()">
							<span class="glyphicon glyphicon-plus"></span>
						</button>
					</div>
				</h3>
			</div>

			<div class="panel-body">

				<div class="list-group">
					<a class="list-group-item" ng-class="{active: (noteBookIsSelected(magicNotebook))}" ng-click="selectNotebook(magicNotebook)">
						{{magicNotebook.title}}
						<span class="badge pull-right">{{totalNoteCount()}}</span>
					</a>
					<a ng-repeat="book in notebooks | orderBy:sortPredicate" class="list-group-item" ng-class="{active: (noteBookIsSelected(book))}" ng-click="selectNotebook(book)">
						{{book.title}}
						<span class="badge pull-right">{{book.noteCount}}</span>
					</a>
				</div>

			</div>
		</div>

		<!-- Notes section -->
		<div class="panel panel-default" id="notes" ng-controller="NoteListController" ng-hide="selectedNotebook == null">

			<!-- Modal dialog to modify Notebook title -->
			<script type="text/ng-template" id="updateNotebookModal.html">
				<div class="modal-header">
					<h3 class="modal-title">Change title</h3>
				</div>
				<div class="modal-body">
					<form name="updateNotebookForm" id="updateNotebookForm" novalidate>
						<input type="text" class="form-control" placeholder="Title of notebook" ng-model="notebook.title" required />
					</form>
				</div>
				<div class="modal-footer">
					<button class="btn btn-primary" ng-click="update()" ng-disabled="updateNotebookForm.$invalid || !updateNotebookForm.$dirty">Ok</button>
					<button class="btn btn-default" ng-click="cancel()">Cancel</button>
				</div>
			</script>

			<div class="panel-heading">
				<h3 class="panel-title">{{selectedNotebook.title}} <span ng-if="search">(filtered)</span>

					<div class="pull-right">
						<div class="btn-group" dropdown>
							<button type="button" class="btn btn-default btn-xs dropdown-toggle">
								<span class="caret"></span>
							</button>
							<ul class="dropdown-menu" role="menu">
								<li ng-class="{disabled: (createButtonDisabled())}"><a href="#" ng-click="showRenameNotebookModal(selectedNotebook)">Rename notebook...</a></li>
								<li ng-class="{disabled: (createButtonDisabled())}"><a href="#" ng-click="createNote()">Create new note</a></li>
								<li class="divider"></li>
								<li ng-class="{disabled: (createButtonDisabled())}"><a href="#" ng-click="deleteNotebook(selectedNotebook)">Delete notebook...</a></li>
							</ul>
						</div>
					</div>

				</h3>
			</div>

			<div class="panel-body">
				<div class="list-group">
					<a class="noteListItem list-group-item" ng-repeat="note in notes" ng-click="selectNote(note)" ng-class="{active: (noteIsSelected(note))}">
						<h5 class="list-group-item-heading">{{note.title}}</h5>
						<p>{{note.updated*1000 | date:'medium'}}</p>
					</a>

				</div>
				<div ng-if="notes.length == 0">
					<p class="text-center" style="padding: 15px;" ng-if="!search">
						<small><strong>No notes</strong> in this notebook. You can create a <a href="#"  ng-click="createNote()">new note</a>.</small>
					</p>

					<p class="text-center" style="padding: 15px;" ng-if="search">
						<small><strong>No search result</strong> found. Try again with a different terms or try searching in a different notebook.
					</p>

				</div>
			</div>
		</div>

		<form name="noteForm" id="noteForm" novalidate role="form" ng-controller="NoteDetailController" ng-hide="note == null">

			<div id="note" class="panel panel-default">

				<div class="panel-heading">
					<input class="panel-title" type="text" placeholder="Title of your note" ng-model="note.title" required />

					<div>
						<select class="form-control input-sm" id="notebook_id" ng-model="note.notebook_id" ng-options="book.id as book.title for book in notebooks"></select>				
					</div>
					&nbsp;
					<div class="btn-group">

						<button ng-click="saveNote(note)" ng-disabled="noteForm.$invalid || !noteForm.$dirty" type="button" class="btn btn-default btn-sm">
							<span class="glyphicon glyphicon-save"></span> Save
						</button>
						<button ng-click="deleteNote(note)" type="button" class="btn btn-default btn-sm">
							<span class="glyphicon glyphicon-trash"></span>
						</button>
					</div>
				</div>

				<div class="panel-body">

					<div class="form-group input-group">
						<label for="notebook_id">Modified</label>
						<p class="form-control-static">
							{{note.updated*1000 | date:'medium'}}
						</p>
					</div>

					<div class="form-group">
						<label for="url">Url</label>
						
						<input id="url" class="form-control" type="text" placeholder="If relevant, add a link here" ng-model="note.url" />
					</div>

					<!-- check http://dev.evernote.com/doc/articles/enml.php for everote html format -->
					<div class="text-angular" text-angular ta-toolbar-group-class="btn-group btn-group-sm" ng-model="note.content"></div>

				</div>
			</div>
		</form>
	</div>
</body>
</html>